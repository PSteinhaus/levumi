<table class='table table-hover table-sm text-small'>
  <thead class='thead-light'>
  <tr>
    <th scope='col'>ID</th>
    <th scope='col'>Name</th>
    <th scope='col'>Aktionen</th>
  </tr>
  </thead>
  <tbody>
  <% Material.all.each do |material| %>
    <tr id='row_<%= material.id %>' >
      <th scope='row'><%= material.id %></th>
      <td><%= material.name %></td>
      <td>
        <div id='material_<%= material.id %>' hidden='true'>
          <%= raw material.description %>
        </div>
        <a href='#' ><button class='show-material btn btn-sm btn-outline-primary' data-id=<%= material.id %>><i class='fas fa-search'></i> Beschreibung</button></a>
        <button data-id=<%= material.id %> data-toggle="modal" data-target='#deleteModal' class='delete-material btn btn-sm btn-outline-danger'><i class='fas fa-trash'></i> Löschen</button>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Material löschen</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Schließen">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Fördermaterial löschen! Sind Sie sicher?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
        <button id="confirm-delete-button" type="button" class="btn btn-primary">Ja, löschen</button>
      </div>
    </div>
  </div>
</div>


<script type="module">
  let materialId = undefined

  $(".show-material").each(function(){
    const self = this
    $(this).on("click", function(){
      const id = $(self).attr("data-id")
      $('#modal-body').html($('#material_' + id).html())
      $('#modal').modal('show')
    })
  })


  $(".delete-material").each(function(){
    $(this).on("click", function(){
      const id = $(this).attr("data-id")
      materialId = id
    })
  })

  $("#confirm-delete-button").on("click", async ()=>{
    const res = await fetch("/materials/" + materialId, { method: "delete",  headers: {
      'X-Requested-With': 'XMLHttpRequest',
      'X-CSRF-Token': document.getElementsByName('csrf-token')[0].getAttribute('content'),
    },})
    if (res.status === 200){
      $("#row_" + materialId).remove()
      materialId = undefined
    }
    $('#deleteModal').modal('hide')

  })

</script>