<nav class="navbar">
  <p class="navbar-brand"><%= "Klasse #{@student.group.name}: Schüler: #{@student.name}: Tasterturschulung" %></p><audio id="itemAudio"></audio>
</nav>
  <div id="text">
    <p style="font-family: 'fibel_nordregular'; font-size:96px" id="itemText" class="text-center">
      Test
    </p>
  </div>
  <div align="center" style="margin-left: 12%">
    <img style="width: 150px " id="picHeadphone" src="/assets/headphones.png"/>
    <img style="width: 150px " id="picKeyboard" src="/assets/tastertur.jpg"/>
    </br>
    </br>
  </div>
  </br>
  </br>
  </br>
  </br>
  </br>
  </br>
  <!-- für die Umlaute ma gucken was er sagt
  <table align="center">
    <tr>
      <th><p id="firstPart">s</th>
      <th><input style="font-family: 'fibel_nordregular'; font-size:96px" id="itemAnswer1" type="text" class="text-center" maxlength="1" size="1"/></th>
      <th><p id="secondPart"/>d</th>
      <th><input style="font-family: 'fibel_nordregular'; font-size:96px" id="itemAnswer2" type="text" class="text-center" maxlength="1" size="1"/></th>
      <th><p id="thirdPart"/>a</th>
  </table>
-->
  <div align="center"  id="footerID">
    <footer>
      <button id="cButton" type="button" class="btn btn-info btn-lg" onclick="cButtonClick()">Nochmal anhören</button>
      <button id="sButton" type="button" class="btn btn-default disabled" onclick="sButtonClick()">Test starten</button>
      <button id="iButton" type="button" class="btn btn-success btn-lg" onclick="iButtonClick()">Weiter</button>
      </br>
      </br>
      <div class="row">
        <div class="col-lg-12">
          <%= link_to url_for(controller: 'frontend') do%><button id="closeButton" type="button" class="btn btn-block btn-warning btn-lg" >Messung abbrechen: <span><img src='/assets/Esc.png'/></span></button><% end %>
        </div>
      </div>
    </footer>
  </div>
</br>


<div><p id="test"></p></div>

<script>
    $(window).keyup(function(event) {
        if(event.keyCode == 27) {
            if(currentItemIndex==0){
                introRdy = false;
                nextItem();
            }
            else {
                $(window).unbind('keyup');
                $('#closeButton').click();
            }
        }
        else if(preparation) {
            switch (event.keyCode) {
                case 37:
                    cButtonClick();
                    break;
                case 39:
                    iButtonClick();
                    break;
                case 13:
                    sButtonClick();
                    break;
            }

        }
        else if(lastPage) {
        }
        else if((!preparation)&&introRdy) {
            introRdy = false;
            nextItem();
        }
        else if((!introRdy)&&levumiExplains) {
            if(currentItemIndex == 3) {
                if(event.keyCode == 0||event.keyCode == 186||event.keyCode == 192||event.keyCode == 222) {
                    nextItem();
                }
            }
            else if(currentItemIndex == 5) {
                if(event.keyCode == 8) {
                    nextItem();
                }
            }
            else if(currentItemIndex == 7) {
                if(event.keyCode == 63) {
                    nextItem();
                }
            }
            else {
                if(event.keyCode == 13) {
                    nextItem();
                }
            }
        }
    });

  /*Initialisierung der Variablen für den Testablauf*/
  var preparation = true;
  var introRdy = true;
  var levumiExplains = true;
  var testSize = 96;
  var testUmlaute =false;
  var testDelete = false;
  var lastPage = false;



  var neededPic = '<img style="float: right; width: 250px "src="/assets/Levumi-jubelt.gif"/>';

  var currentItemIndex = -1;
  var timeoutId = -1;
  var currentTimes = "";
  var stopwatch = null;
  /*Liste aller Items, wleche zum Test gehören*/
  var itemData =
      [   "„Hallo ich bin Levumi. Ich möchte heute mit dir üben, auf der Tastatur von einem Computer zu schreiben. "+
          "Bitte höre mir ganz genau zu, damit du weisst, was du tun sollst. "+
          "Bitte drücke jetzt irgendeine Taste auf der Tastatur, damit wir beginnen können.“",//0
          "„Um zur nächsten Aufgabe zu kommen, benutzen wir die Eingabetaste. Auf dem Bild sieht du wo diese Taste auf der Tastertur zu finden ist. Probier sie doch gleich mal aus.“",//1
          "„Hier siehst du auf dem Bild einen Kopfhörer. Immer, wenn du den Kopfhörer siehst, musst du gut zuhören, damit du genau weißt, was du tun sollst. "+
          "Das Bild mit der Tastatur zeigt dir, wann du etwas mit der Tastatur eingeben sollst.“",//2
          "„ä, ü, ö sind Umlaute, bestimmt kennst du diese Buchstaben. Auf der Tastatur findest du diese Buchstaben auf der rechten Seite. " +
          " Auf dem Bild siehst du, wo du die Buchstaben auf der Tastatur finden kannst. "+
          "Bitte drücke jetzt das ä, ü oder ö.“",//3
          "„In den folgenden Wörtern fehlen die Umlaute. Kannst du mir bitte helfen, diese wieder einzufügen? Bitte ergänze jetzt für mich die fehlenden Umlaute.“",//4
          "„Bestimmt hast du schon einmal an einem Computer etwas geschrieben, das du wieder löschen wolltest. Dafür benutzt man die Löschtaste. Auf dem Bild kannst du erkennen," +
          " wo du die Taste finden kannst. Bitte drücke jetzt die Löschtaste auf der Tastatur.“",//5
          "„Jetzt benötige ich unbedingt deine Hilfe. Ich habe einen Satz geschrieben und möchte diesen wieder löschen. Bitte benutze die Löschtaste und lösche alle Buchstaben für mich.“",//6
          "„Nun geht es um einen Buchstaben, den es nur im Deutschen gibt, das ß. Es hat sich auf der Computertastatur oben rechts ziemlich gut versteckt. Drücke bitte die Taste für das ß auf der Tastatur.“",//7
          "„Um ein Wort großzuschreiben, muss man zwei Tasten gleichzeitig drücken: Den Pfeil, der nach oben zeigt, " +
          "ganz links auf der Tastatur und eine Buchstabentaste. Am besten benutzt du dafür deine beiden Zeigefinger.“",//8
          "„Bitte ergänze in den folgenden Wörtern die Großbuchstaben.“",//9
          "„Danke, dass du so gut mitmachst!“",//10
          "„Jetzt hast du schon gut geübt, auf der Tastatur zu schreiben. Nun diktiere ich dir einen Satz. Bitte schreibe die Wörter so schnell du kannst. Aber achte genau auf die richtige Schreibung!" +
          " Die Wörter, die du schreiben sollst, sind gelb makiert. Wenn du das Wort geschrieben hast, drücke die Eingabetaste, damit du zum nächsten Wort gelangst.“",//11
          "„Die Familie Schmidt hat einen großen Obstgarten mit Apfelbäumen, Quittenbäumen und Kirschbäumen. Aus dem Obst machen sie viele Gläser Marmelade. Lecker!“",//12
          "„Super, du hast es geschafft! Das hast du toll gemacht! Zum Beenden des Testes drücke bitte die Escapetaste.“"];//13
  /*Liste aller Items, wleche zum Test gehören*/
  var itemDataSound =[];



  /*was kann sollte noch vor Testbeginn gemacht/angezeigt werden
   * TODO: Bild und andere Kleinigkeiten. siehe auch Diktiertest*/
  function prepareTest() {
        $('#itemText').css('font-size', 96).html("Test");
        $('#picHeadphone').hide();
        $('#picKeyboard').hide();
        /*
        $('#itemAnswer').val('');
        $('#itemAnswer').attr('maxlength',6);
        $('#itemAnswer').focus();
        var fileName = "/assets/Test.mp3";
        $("#itemAudio").attr("src",fileName).trigger('play');
        */
        $('#cButton').html("Schrift  größer");
        $('#iButton').html("Schrift kleiner");
        setButtons(true);
    }
  function intro() {
      preparation = false;
      testSize = parseInt($('#itemText').css('font-size'));
      $('#itemText').css('font-size', 60);
      $('#cButton').html("Nochmal anhören");
      $('#iButton').html("    Weiter     ");
      nextItem();
  }
  function nextItem() {
      currentItemIndex++;
      if(currentItemIndex<itemData.length) {
          switch (currentItemIndex) {
              case 0:
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 1:
                  $('#picHeadphone').attr('src', '/assets/Enter.jpg').width(450).show();
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 2:
                  $('#picHeadphone').attr('src', '/assets/headphones.png').width(150);
                  $('#picKeyboard').show()
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 3:
                  $('#picHeadphone').hide();
                  $('#picKeyboard').hide();
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 4:
                  $('#picHeadphone').show();
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 5:
                  $('#picHeadphone').attr('src', '/assets/backspace.png').width(450);
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 6:
                  testUmlaut();
                  break;
              case 7:
                  testDelet();
                  break;
              case 8:
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 9:
                  $('#picHeadphone').attr('src', '/assets/headphones.png').width(150);
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 10:
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 11:
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 12:
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  break;
              case 13:
                  $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
                  var fileName = "";
                  $("#itemAudio").attr("src",fileName).trigger('play');
                  lastPage=true;
                  stopTest();
                  break;

          }
      }
      else {
          stopTest();
      }

  }
  function testUmlaut(){
      testUmlaute = true;
      $('#picHeadphone').attr('src', '/assets/headphones.png').width(150);
      $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
      var fileName = "";
      $("#itemAudio").attr("src",fileName).trigger('play');
  }
    function testDelet(){
        testDelete = true;
        $('#picHeadphone').attr('src', '/assets/headphones.png').width(150);
        $('#itemText').html(itemData[currentItemIndex]).append(neededPic);
        var fileName = "";
        $("#itemAudio").attr("src",fileName).trigger('play');
    }
  /*Testphase beginnt*/
  function startTest() {
      preparation=false;
      $('#cButton').html("Nochmal anhören");
      $('#iButton').html("Weiter");
      setButtons(true);
      currentTimes = "";
      nextItem();
      if (timeoutId != -1) {
          window.clearTimeout(timeoutId);
      }
      timeoutId = window.setTimeout(stopTest, <%= 180*1000 %> + 500, true);
  }
  /*Wenn Zeit abgelaufen oder alle Wörter durchgelaufen test beenden*/
  function stopTest(timeout) {
      if (timeoutId != -1) {
          window.clearTimeout(timeoutId);
          timeoutId = -1;
      }
      $('#closeButton').html("Messung beenden: <span><img src='/assets/Esc.png'/></span>");
      $('#picHeadphone').hide();
      $('#picKeyboard').hide();
      setButtons(false);
  }



  function iButtonClick() {

      if (!$('#iButton').hasClass("disabled")) {
          if (preparation) {
              curSize = parseInt($('#itemText').css('font-size')) - 6;
              $('#itemText').css('font-size', curSize);
              /*
              $('#itemAnswer').css('font-size',curSize)
              */
          }
          else {
              stopwatch = new Date() - stopwatch;
              currentTimes = currentTimes + stopwatch + ",";
              nextItem();
          }
      }
  }

  function cButtonClick() {

      if (!$('#cButton').hasClass("disabled")) {
          if (preparation) {
              curSize=parseInt($('#itemText').css('font-size')) + 6;
              $('#itemText').css('font-size', curSize);
              /*
              $('#itemAnswer').css('font-size',curSize)
              */
          }
          else {
              var h = document.getElementById("itemAudio");
              h.pause();
              h.currentTime = 0;
              h.play();
          }
      }
  }

  function setButtons(enabled) {
      if (enabled) {
          if (preparation) {
              $('#cButton').removeClass("disabled");
              $('#cButton').removeClass("btn-info");
              $('#sButton').removeClass("disabled");
              $('#sButton').addClass("btn-success");
              $('#iButton').removeClass("disabled");
              $('#iButton').removeClass("btn-success");
          }
          else {
              $('#cButton').removeClass("disabled");
              $('#cButton').addClass("btn-info");
              $('#iButton').removeClass("disabled");
              $('#iButton').addClass("btn-success");
              $('#sButton').addClass("disabled");
              $('#sButton').removeClass("btn-success");
          }
      }
      else {
          $('#cButton').addClass("disabled");
          $('#cButton').removeClass("btn-info");
          $('#iButton').addClass("disabled");
          $('#iButton').removeClass("btn-success");
          $('#sButton').addClass("disabled");
          $('#sButton').removeClass("btn-success");
      }
  }

  function sButtonClick() {
      if (preparation) {
          intro();
      }
  }
/*
  function clearInput() {
      $('#itemAnswer').val('');
  }
  */
  /*Befehle/Funktionen die direkt ausgeführt werden, ohne Funktionsaufruf*/
  $(window).onload = prepareTest();

  /*Pfeile fürs Input feld abstellen
  $('#itemAnswer').keydown(function(e){
      var key = e.charCode || e.keyCode;
      if (key == 37||key == 38||key == 39||key == 40||key == 32) {
          // enter key do nothing
          e.preventDefault();
      }
      else {

      }
  });
   */

  /*funktionen bei Tastendruck auf der Seite*/


  $('#fotter').css({position:absolute, bottom:0});
</script>