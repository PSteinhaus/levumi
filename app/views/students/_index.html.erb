<p class="lead text-right">
  <%= link_to user_group_students_path(@user, @group, :format => :pdf), :title => "Zugangsdaten der Klasse", :target => "blank" do %>
      <span class="glyphicon glyphicon-print"></span>
  <% end %>
</p>
<table class="table table-striped" id="studentTable">
  <thead>
  <th>
    Schüler/-in
  </th>
  <th>
    Login-Code
  </th>
  <th>
    Geschlecht
  </th>
  <th>
    Geburtsdatum
  </th>
  <th>
    Migrationshintergrund
  </th>
  <th>
    Förderbedarf
  </th>
  <th>
    Insgesamte Messungen
  </th>
  <th>
    Aktion
  </th>
  </thead>
  <tbody>
  <% @group.students.sort_by { |a| a.id}.each do |student| %>
      <tr>
        <td id ='<%= student.id %>'>
        </td>
        <td>
          <%= student.login %>
        </td>
        <td>
          <%= raw(student.get_gender) %>
        </td>
        <td>
          <%= raw(student.get_birthdate) %>
        </td>
        <td>
          <%= raw(student.get_migration) %>
        </td>
        <td>
          <%= raw(student.get_specific_needs) %>
        </td>
        <td>
          <%= link_to user_group_student_path(@user, @group, student), :data => {:remote => true} do %>
            <%= (student.results.map{|x| x.score} - [nil]).size %>
          <% end %>
        </td>
        <td>
            <%= link_to edit_user_group_student_path(@user, @group, student), :data => {:remote => true} do %>
                <span class="glyphicon glyphicon-pencil"></span>
            <% end %>
            <%= link_to user_group_student_path(@user, @group, student), :method => :delete, :data => {:remote => true, :confirm => "Sind Sie sicher?"} do %>
                <span class="glyphicon glyphicon-trash"></span>
            <% end %>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>
<div id="studentForm">
  <%= link_to "Schüler/-in hinzufügen", new_user_group_student_path(@user, @group), :class => "btn btn-default", :data => {:remote => true} %>
</div>
<script>
    var students = JSON.parse(sessionStorage['students']);

    Object.keys(students["<%=@group.id%>"]).forEach(function(keyStudent) {
        $('#'+ keyStudent).html(students["<%=@group.id%>"][keyStudent])
    });
    $(document).ready(function () {
        sort();
    })

    function sort() {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("studentTable");
        switching = true;
      /*Make a loop that will continue until
       no switching has been done:*/
        while (switching) {
            //start by saying: no switching is done:
            switching = false;
            rows = table.getElementsByTagName("TR");
          /*Loop through all table rows (except the
           first, which contains table headers):*/
            for (i = 1; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;
              /*Get the two elements you want to compare,
               one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("TD")[0];
                y = rows[i + 1].getElementsByTagName("TD")[0];
                //check if the two rows should switch place:
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    //if so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
              /*If a switch has been marked, make the switch
               and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }
</script>