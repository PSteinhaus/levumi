<%
  data = {
      groups: [Group.new] + @groups
  }

  #Temporäer Hack
  students = {}
  @user.students.each do |s|
    students[s.group_id] ||= []
    students[s.group_id] += [s]
  end
%>

<script>
  //Eintrag in der Navleiste markieren
  highlightNavItem("navbarKlassenbuch");

  //Temporärer Hack!
  sessionStorage['students'] = "<%= escape_javascript(raw students.to_json)%>";
</script>

<div id='levumi' data="<%= data.to_json%>">
    <b-container fluid>
      <b-row class="mt-5">
        <b-col md="12">

          <b-tabs pills>

            <b-tab active>
              <template slot="title">
                Aktuelle Klassen
              </template>

              <b-card no-body>
                <b-tabs pills card>

                  <!-- Neue Klasse anlegen -->
                  <b-tab>
                    <template slot="title">
                      <i class="fas fa-folder-plus"></i>
                    </template>
                    <group-form
                      :group="groups[0]"
                      :index="0"
                      v-on:update:groups="groups.splice(1, 0, $event.object)"
                    ></group-form>
                  </b-tab>

                  <!-- Alle Klassen als Tabs anzeigen -->
                  <b-tab
                    v-for="(group, index) in groups"
                    v-if="index > 0 & group.archive == false"
                    :key="group.id"
                    :title="group.label"
                    :active="index == 1"
                  >
                    <group-display
                      :groups="groups"
                      :index="index"
                    ></group-display>
                  </b-tab>

                </b-tabs>
              </b-card>
            </b-tab>

            <!-- Klassenarchiv -->
            <b-tab>
              <template slot="title">
                Klassenarchiv
              </template>

              <b-card no-body>
                <b-tabs pills card vertical>

                  <!-- Hinweistext falls keine Klasse vorhanden -->
                  <div slot="empty">
                    <div v-if="!$data">
                      <div class="spinner">
                        <div class="bounce1"></div>
                        <div class="bounce2"></div>
                        <div class="bounce3"></div>
                      </div>
                    </div>
                    <div v-else class="v-cloak text-center text-muted">
                      Keine Klassen im Archiv vorhanden.
                    </div>
                  </div>

                  <b-tab
                    v-for="(group, index) in groups"
                    v-if="group.archive == true"
                    :key="group.id"
                    :title="group.label"
                  >
                    <group-display
                      :groups="groups"
                      :index="index"
                    ></group-display>
                  </b-tab>
                </b-tabs>
              </b-card>

            </b-tab>

          </b-tabs>

        </b-col>
       </b-row>
    </b-container>
</div>

